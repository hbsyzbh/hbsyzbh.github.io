<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MultiCastAddr</title>
        <!--引入外部的css文件-->
        <link rel="stylesheet" href="bootstrap5/bootstrap.css" />
        <!--引入外部的js文件-->
        <script type="text/javascript" src="bootstrap5/bootstrap.js" ></script>
        <style>
        </style>
    </head>
    <body>
        <div class="row">
        <div class="col-6">
        <table class="table">
          <thead>
            <tr>
              <th scope="col"> </th>
              <th scope="col">IPV4</th>
              <th scope="col">MacAddr</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row"> </th>
              <td ><input id="ipv4" value="224.1.1.1" oninput="onipv4Changed()"></td>
              <td id="V4MacAddr">01 00 5E 01 01 01</td>
            </tr>
          </tbody>
        </table>
        </div>
        <!--
           Host groups are identified by class D IP addresses, i.e., those with
            "1110" as their high-order four bits.  Class E IP addresses, i.e.,
            those with "1111" as their high-order four bits, are reserved for
            future addressing modes.

            In Internet standard "dotted decimal" notation, host group addresses
            range from 224.0.0.0 to 239.255.255.255.  The address 224.0.0.0 is
            guaranteed not to be assigned to any group, and 224.0.0.1 is assigned
            to the permanent group of all IP hosts.  This is used to address all
            multicast hosts on the directly connected network.  There is no
            multicast address (or any other IP address) for all hosts on the
            total Internet.  The addresses of other well-known, permanent groups
            are to be published in "Assigned Numbers".
        -->
        <script type="text/javascript">
            function get2ByteHex(v) {
                var v_int = parseInt(v);
                
                if (v_int < 16) {
                    return "0" + v_int.toString(16).toUpperCase(); 
                }
                
                return v_int.toString(16).toUpperCase();
            }
            
            function calcIpv4MultiCastAddr(ip) {
                var ipArray = ip.split(".");
                if( ipArray.length != 4) {
                    return "无效ip(v4)";
                }
                
                for(var i = 0; i < 4; i++) {
                    if ((ipArray[i].trim() == "") || (ipArray[i] < 0) || (ipArray[i] > 255)) {
                        return "错误ip";
                    }
                }
                
                
                if ((ipArray[0] >  239)  ||(ipArray[0] < 224)) {
                    return "非D类IP地址";
                }
                
               

                return "01 00 5E " + get2ByteHex(parseInt(ipArray[1]) % 128) + " "+ get2ByteHex(ipArray[2]) + " "+ get2ByteHex(ipArray[3]);
            }
            
            function onipv4Changed() {
                V4MacAddr.innerText = calcIpv4MultiCastAddr(ipv4.value);
            }
        </script>

        <div class="col-6">
        <table class="table">
          <thead>
            <tr>
              <th scope="col"> </th>
              <th scope="col">IPV6</th>
              <th scope="col">MacAddr</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row"> </th>
              <td><input id="ipv6" value="FF01::1" oninput="onipv6Changed()"></td>
              <td id="V6MacAddr">33 33 00 00 00 01</td>
            </tr>
          </tbody>
        </table>
        </div>
        <!--
                An IPv6 packet with a multicast destination address DST, consisting
                of the sixteen octets DST[1] through DST[16], is transmitted to the
                Ethernet multicast address whose first two octets are the value 3333
                hexadecimal and whose last four octets are the last four octets of
                DST.
                  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  |0 0 1 1 0 0 1 1|0 0 1 1 0 0 1 1|
                  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  |   DST[13]     |   DST[14]     |
                  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                  |   DST[15]     |   DST[16]     |
                  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        comment -->
        <script type="text/javascript">
            function get2ByteHex(v) {
                var v_int = parseInt(v);
                
                if (v_int < 16) {
                    return "0" + v_int.toString(16).toUpperCase(); 
                }
                
                return v_int.toString(16).toUpperCase();
            }
            
            function calcIpv6MultiCastAddr(ip) {
                var ipv6addr = [0,0,0,0,0,0,0,0];
                var ipArray = ip.split(":");
                if(( ipArray.length < 3) || (( ipArray.length > 8))) {
                    return "无效ip(v6) 仅支持:分隔";
                } else if (ipArray.length != 8) {
                    if (ip.indexOf("::") < 0) {                 
                        return "无效ip(v6) 长度不够";
                    }
                }

                var j = 0;
                for(var i = 0; i < ipArray.length; i++) {
                    if (ipArray[i].trim() == "") {
                        break;
                    } else {
                        ipv6addr[j++] = parseInt(ipArray[i], 16);
                    }
                }
                
                if (j != 8) {
                    var j = 7;
                    for(var i = ipArray.length - 1; i > 0 ; i--) {
                        if (ipArray[i].trim() == "") {
                            break;
                        } else {
                            ipv6addr[j--] = parseInt(ipArray[i], 16);
                        }
                    }
                }                
               
               console.log(ipv6addr);
               var result = "33 33";
               for (var i = 6; i <8; i++) {
                   result +=  " " + get2ByteHex(ipv6addr[i] / 256) +  " " + get2ByteHex(ipv6addr[i] % 256);
               }

                return result;
            }
            
            function onipv6Changed() {
                V6MacAddr.innerText = calcIpv6MultiCastAddr(ipv6.value);
            }
        </script>
        
        </div><!-- end of row -->
    </body>
</html>
